<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¬Ø¯ÙˆÙ„ ØµÙ„Ø§Ø© Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­ - Ø¬Ø§Ù…Ø¹ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø±Ø¨ÙŠØ¹ Ø¨Ù† Ø­Ø¨ÙŠØ¨</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');

:root{
  --bg:#f0f4f2;
  --card:#ffffff;
  --accent:#34624f;
  --gold:#d4af37;
  --muted:#6b705c;
  --friday:#cfe3d6;
  --header-col:#49876d;
  --first-col:#49876d;
}
table td, table th {
    border: 1px solid #bdbdbd !important;
}
td, th {
    text-align: center !important;
    vertical-align: middle !important;
}

html, body{
  margin:0;
  padding:1rem;
  font-family:'Amiri', serif;
  background:var(--bg) url('https://www.toptal.com/designers/subtlepatterns/uploads/moroccan-flower.png') repeat;
  background-size:300px;
  color:#000;
}

.container{
  max-width:1000px; margin:20px auto; padding:15px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:22px;
  border:4px solid var(--gold);
  box-shadow:0 8px 24px rgba(0,0,0,0.08);
  position:relative;
}

.card:before{
  content:""; position:absolute; top:-10px;left:-10px;right:-10px;bottom:-10px;
  border:3px solid var(--gold); border-radius:20px; pointer-events:none;
}

h1::before{
  content:""; display:block; width:140px; height:160px; margin:0 auto 10px auto;
  background:url('./img.png') center/contain no-repeat;
}

h1,h2{
  font-size:26px; text-align:center; margin-bottom:15px;
  color:var(--accent); font-weight:700;
}

.table-wrapper{
  width:100%; overflow-x:auto; margin-top:10px;
}

table{
  width:100%; min-width:650px; border-collapse:collapse;
  font-size:18px; margin-top:1rem;
  background:#fff; border-radius:12px;
  overflow:hidden; border:2px solid #a9a9a9;
}

thead th{
  background:var(--header-col); color:#fff; text-align:center;
  padding:0.5rem; font-size:18px; border:1px solid #a9a9a9;
}

td[contenteditable="true"] {
    direction: rtl;
    unicode-bidi: plaintext;
    text-align: center !important;
    vertical-align: middle !important;
}

tbody tr:nth-child(odd){ background: rgba(245,245,245,0.7); }
tbody tr:nth-child(even){ background:#ffffff; }
tbody tr:hover{ background:#e0f0e8; }

tbody td:first-child{
  background:var(--first-col); color:#fff; font-weight:700; width:120px;
}

tbody tr.friday{ background-color:var(--friday) !important; }

.card-header{
  display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;
  padding:12px 10px;
}

#saveBtn,#printBtn{
  padding:10px 16px; border-radius:12px; cursor:pointer;
  font-weight:bold; color:#fff; font-size:15px;
  border:none; transition:0.2s;
}

#saveBtn{ background:var(--gold); }
#saveBtn:hover{ background:#c49b2c; }

#printBtn{ background:var(--accent); margin-left:10px; }
#printBtn:hover{ background:#397155; }

#saveMessage{
  color:green; font-weight:bold; display:none; margin-right:8px;
}

.contact-box{
  background:var(--card); padding:8px 15px;
  border:2px solid var(--gold); border-radius:12px;
  text-align:center; color:var(--accent);
  font-size:15px; line-height:1.6;
}

@media print{
  body *{ visibility:hidden; }
  #mainTable,#mainTable *{ visibility:visible; }
  #mainTable{ position:absolute; top:0; left:0; width:100%; }
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>

<div class="container">
<div class="card">
<div class="card-header">
<div style="display:flex;align-items:center;">
<button id="saveBtn">ğŸ’¾ Ø­ÙØ¸</button>
<span id="saveMessage">ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…</span>
<button id="printBtn">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
</div>

<div class="contact-box">
<strong>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø§Ù…Ø¹:</strong><br>
ÙÙŠØµÙ„ Ø§Ù„Ù…Ø¨Ø³Ù„ÙŠ: 98036047<br>
Ø¯Ø§ÙˆÙˆØ¯ Ø§Ù„Ù…Ø¨Ø³Ù„ÙŠ: 95522897
</div>
</div>

 <h1>Ø¬Ø¯ÙˆÙ„ ØµÙ„Ø§Ø© Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­ - Ø¬Ø§Ù…Ø¹ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø±Ø¨ÙŠØ¹ Ø¨Ù† Ø­Ø¨ÙŠØ¨</h1>
    <h2>Ø§Ù„Ø³ÙŠØ¨ - ÙˆØ§Ø¯ÙŠ Ø§Ù„Ù„ÙˆØ§Ù…ÙŠ</h2>
  
<div class="table-wrapper">
<table id="mainTable">
<thead>
<tr>
 <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ø³Ù… Ø§Ù„Ø¥Ù…Ø§Ù…</th>
            <th>Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

</div>
</div>

<script>
/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase */
// Ø¥Ø¹Ø¯Ø§Ø¯ Firebase Ø§Ù„Ø¬Ø¯ÙŠØ¯
const firebaseConfig = {
  apiKey: "AIzaSyC54cdPVh730M-AC8MFpoU8YuXckzoQcvY",
  authDomain: "taraweehprayer1447.firebaseapp.com",
  databaseURL: "https://taraweehprayer1447-default-rtdb.firebaseio.com",
  projectId: "taraweehprayer1447",
  storageBucket: "taraweehprayer1447.firebasestorage.app",
  messagingSenderId: "1007291606404",
  appId: "1:1007291606404:web:4acc20e78f9485ee8669d1",
  measurementId: "G-WP7PW0LFG6"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const TOTAL_DAYS = 30;
const START_DATE = new Date(2026,1,18);
const weekdays = ["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
const tbody = document.querySelector("#mainTable tbody");

for(let i=1;i<=TOTAL_DAYS;i++){
  const tr = document.createElement("tr");
  const date = new Date(START_DATE);
  date.setDate(START_DATE.getDate()+(i-1));
  const weekdayName = weekdays[date.getDay()];

  if(weekdayName === "Ø§Ù„Ø¬Ù…Ø¹Ø©") tr.classList.add("friday");

  // Ø§Ù„ØªØ§Ø±ÙŠØ®
  const tdDate = document.createElement("td");
  tdDate.contentEditable = true;
  tdDate.textContent = `${date.getDate()}/${date.getMonth()+1}/${date.getFullYear()} - ${weekdayName} - Ø±Ù…Ø¶Ø§Ù† ${i}`;
  tr.appendChild(tdDate);

  // Ø§Ø³Ù… Ø§Ù„Ø¥Ù…Ø§Ù…
  const tdName = document.createElement("td");
  tdName.contentEditable = true;
  tr.appendChild(tdName);

  // Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„
  const tdPhone = document.createElement("td");
  tdPhone.contentEditable = true;
  tr.appendChild(tdPhone);

  tbody.appendChild(tr);
}

// ğŸ”¥ Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù†ØµÙˆØµ Ø¹Ù„Ù‰ iPhone
function placeCaretAtEnd(el){
  const range=document.createRange();
  const sel=window.getSelection();
  range.selectNodeContents(el);
  range.collapse(false);
  sel.removeAllRanges();
  sel.addRange(range);
}

document.addEventListener("focusin", function(e){
  if(e.target.matches('td[contenteditable="true"]')){
    e.target.setAttribute("dir","rtl");
    e.target.setAttribute("lang","ar");

    let val=e.target.textContent.trim();
    if(!val || !/[\u0600-\u06FF]/.test(val[0])){
      if(!e.target.textContent.startsWith("\u200F")){
        e.target.textContent="\u200F"+e.target.textContent;
        placeCaretAtEnd(e.target);
      }
    }
  }
});

document.addEventListener("input", function(e){
  if(e.target.matches('td[contenteditable="true"]')){
    if(!e.target.textContent.startsWith("\u200F")){
      e.target.textContent="\u200F"+e.target.textContent;
      placeCaretAtEnd(e.target);
    }
  }
});

// ØªÙ†Ø¸ÙŠÙ RLM Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸
function clean(v){
  return v ? v.replace(/^\u200F/,"").trim() : "";
}

// Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
tbody.addEventListener("input", ()=>{
  const rows = [...tbody.querySelectorAll("tr")].map(tr=>{
    const tds = tr.querySelectorAll("td");
    return {
      date: clean(tds[0].textContent),
      lecturer: clean(tds[1].textContent),
      contact: clean(tds[2].textContent)
    };
  });
  db.ref("ramadan_lectures").set(rows);
  saveMessage.style.display="inline";
  setTimeout(()=>saveMessage.style.display="none",1500);
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
db.ref("ramadan_lectures").on("value", snap=>{
  const data = snap.val();
  if(!data) return;
  tbody.querySelectorAll("tr").forEach((tr,i)=>{
    if(!data[i]) return;
    const tds = tr.querySelectorAll("td");
    tds[0].textContent = data[i].date;
    tds[1].textContent = data[i].lecturer;
    tds[2].textContent = data[i].contact;
  });
});
</script>

</body>
</html>

